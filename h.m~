%function out = h(x_r, y_r, theta, x_l, y_l, z_l, focal_length)
%H measurement model
function out = h(x, focal_length)

x_r = x(1);
y_r = x(2);
theta = x(3);
x_l = x(4);
y_l = x(5);
z_l = x(6);
out = zeros(2);
out(1) = sqrt((x_l - x_r)*(x_l - x_r) + (y_l - y_r)*(y_l - y_r))*focal_length/z_l;
out(2) = pi/2 - atan2(y_l-y_r, x_l-x_r) + theta;

out = out';
end

%%
function f()
%%
syms x_l y_l z_l x_r y_r theta focal_length real
r = [x_r ,y_r, theta, x_l, y_l, z_l];
observation = h(r, focal_length);
p_r = jacobian(observation, r)


jacobian([sqrt((x_l - x_r)*(x_l - x_r) + (y_l - y_r)*(y_l - y_r))*focal_length/z_l

end